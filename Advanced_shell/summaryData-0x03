#!/usr/bin/env bash
# summaryData-0x03
# Summarize PokÃ©mon data from JSON files and generate CSV report with averages.

DIR="pokemon_data"
OUT="pokemon_report.csv"

# Check if directory exists
if [ ! -d "$DIR" ]; then
  echo "Error: Directory $DIR does not exist. Run Task 2 first."
  exit 1
fi

# Prepare CSV header
echo "Name,Height (m),Weight (kg)" > "$OUT"

# Extract name, height, weight from each JSON file and append to CSV
for file in "$DIR"/*.json; do
  # Use jq to extract values
  name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')
  height=$(jq -r '.height' "$file" | awk '{printf "%.1f", $1/10}')
  weight=$(jq -r '.weight' "$file" | awk '{printf "%.1f", $1/10}')
  
  echo "$name,$height,$weight" >> "$OUT"
done

echo "CSV Report generated at: $OUT"
echo ""

# Calculate averages using awk
awk -F, '
NR>1 {height_sum+=$2; weight_sum+=$3; count++}
END {
  if (count > 0) {
    printf "Average Height: %.2f m\n", height_sum/count;
    printf "Average Weight: %.2f kg\n", weight_sum/count;
  }
}' "$OUT"
